# Feature Pack: dashboard-shell
# Provides the dashboard shell (layout, sidebar, topbar, notifications) for HIT apps
# Also includes the table views system for user-customizable data table views

name: dashboard-shell
description: Dashboard shell with sidebar, topbar, notifications, theme support, and table views system

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/table-views.ts
  exports:
    - tableViews
    - tableViewFilters
    - tableViewShares
    - tableViewsRelations
    - tableViewFiltersRelations
    - tableViewSharesRelations
    - principalTypeEnum
    - TableView
    - TableViewFilter
    - TableViewShare
    - InsertTableView
    - InsertTableViewFilter
    - InsertTableViewShare
    - FILTER_OPERATORS
    - FILTER_VALUE_TYPES
    - FilterOperator
    - FilterValueType

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES - Backend endpoints for table views
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    - path: /api/table-views
      methods: [GET, POST]
      handler: "@hit/feature-pack-dashboard-shell/server/api/table-views"
      description: "List views (GET) or create view (POST)"
    - path: /api/table-views/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-dashboard-shell/server/api/table-views-id"
      description: "Get, update, or delete a view"
    - path: /api/table-views/[id]/use
      methods: [PATCH]
      handler: "@hit/feature-pack-dashboard-shell/server/api/table-views-use"
      description: "Mark a view as used (update lastUsedAt)"
    - path: /api/table-views/[id]/shares
      methods: [GET, POST, DELETE]
      handler: "@hit/feature-pack-dashboard-shell/server/api/table-views-shares"
      description: "List, add, or remove share entries for a view"

    # Generic table data helpers (config-driven providers)
    - path: /api/table-data/batch
      methods: [POST]
      handler: "@hit/feature-pack-dashboard-shell/server/api/table-data-batch"
      description: "Fetch table rows by ids for a given tableId (uses provider registry)"

    - path: /api/table-data/grouped-buckets
      methods: [POST]
      handler: "@hit/feature-pack-dashboard-shell/server/api/table-data-grouped-buckets"
      description: "Fetch grouped rows for a segment bucket column (tableId+columnKey) via metrics-core + providers"

    # Dashboards v0 (view-only) — DB-backed definitions + ACL shares
    - path: /api/dashboard-definitions
      methods: [GET, POST]
      handler: "@hit/feature-pack-dashboard-shell/server/api/dashboard-definitions"
      description: "List dashboard definitions visible to the user (GET) or create a dashboard definition (POST)"
    - path: /api/dashboard-definitions/[key]
      methods: [GET, PUT]
      handler: "@hit/feature-pack-dashboard-shell/server/api/dashboard-definitions-key"
      description: "Get a dashboard definition (GET) or update a user-owned definition (PUT)"
    - path: /api/dashboard-definitions/[key]/shares
      methods: [GET, POST, DELETE]
      handler: "@hit/feature-pack-dashboard-shell/server/api/dashboard-definitions-shares"
      description: "List/add/remove share entries for a dashboard definition (ACL)"

routes:
  - path: /dashboards
    page: Dashboards
    roles: []

## Nav entry intentionally omitted for MVP:
## dashboards should be discovered from within the Projects feature pack (not global/root).

# No module dependencies
requires:
  modules: []

# Configurable options
config:
  schema:
    brand_name:
      type: string
      default: HIT
      description: Brand/app name shown in navigation
    logo_url:
      type: string
      default: /icon.png
      description: Logo image URL
    sidebar_position:
      type: string
      enum: [left, right]
      default: left
      description: Sidebar position
    show_notifications:
      type: boolean
      default: true
      description: Show notification bell in topbar
    show_theme_toggle:
      type: boolean
      default: true
      description: Show dark/light mode toggle
    show_user_menu:
      type: boolean
      default: true
      description: Show user menu in topbar
    default_theme:
      type: string
      enum: [light, dark, system]
      default: system
      description: Default theme mode
    # dashboards_enabled removed as part of dashboard system reset.
